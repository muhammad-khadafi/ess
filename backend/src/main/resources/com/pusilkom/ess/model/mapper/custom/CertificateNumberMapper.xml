<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pusilkom.ess.model.mapper.CertificateNumberMapper">

  <resultMap id="CertificateNumberResultMap" type="com.pusilkom.ess.dto.table.CertificateNumberItem">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="category" jdbcType="VARCHAR" property="category" />
    <result column="course_date" jdbcType="DATE" property="courseDate" />
    <result column="course_name" jdbcType="VARCHAR" property="courseName" />
    <result column="certificate_number" jdbcType="VARCHAR" property="certificateNumber" />
  </resultMap>

  <select id="getRegulerSequence" resultType="Long">
    SELECT nextval('certificate_number_reguler_seq');
  </select>

  <select id="getShortCourseSequence" resultType="Long">
    SELECT nextval('certificate_number_short_course_seq');
  </select>

  <select id="getIHTSequence" resultType="Long">
    SELECT nextval('certificate_number_iht_seq');
  </select>

  <select id="getListCertificateNumberItemBySearchForm" resultMap="CertificateNumberResultMap" parameterType="map">
    select * from certificate_number
    <where>
      <if test="searchForm.category != '' and searchForm.category != null">
        AND upper(category) LIKE '%' || upper(#{searchForm.category}) || '%'
      </if>
      <if test="searchForm.courseDate != '' and searchForm.courseDate != null">
        AND course_date = #{searchForm.courseDate}
      </if>
      <if test="searchForm.courseName != '' and searchForm.courseName != null">
        AND upper(course_name) LIKE '%' || upper(#{searchForm.courseName}) || '%'
      </if>
      <if test="searchForm.certificateNumber != '' and searchForm.certificateNumber != null">
        AND upper(certificate_number) LIKE '%' || upper(#{searchForm.certificateNumber}) || '%'
      </if>
    </where>
    order by category asc
    OFFSET #{searchForm.from} - 1 LIMIT #{searchForm.perPage}

  </select>

  <select id="getTotalListCertificateNumberItemBySearchForm" resultType="Long" parameterType="map">
    select count(*) from certificate_number
    <where>
      <if test="searchForm.category != '' and searchForm.category != null">
        AND upper(category) LIKE '%' || upper(#{searchForm.category}) || '%'
      </if>
      <if test="searchForm.courseDate != '' and searchForm.courseDate != null">
        AND course_date = #{searchForm.courseDate}
      </if>
      <if test="searchForm.courseName != '' and searchForm.courseName != null">
        AND upper(course_name) LIKE '%' || upper(#{searchForm.courseName}) || '%'
      </if>
      <if test="searchForm.certificateNumber != '' and searchForm.certificateNumber != null">
        AND upper(certificate_number) LIKE '%' || upper(#{searchForm.certificateNumber}) || '%'
      </if>
    </where>

  </select>

</mapper>